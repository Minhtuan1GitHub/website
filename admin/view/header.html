<main>
  <div class="container">
    <!-- Dropdown chọn năm -->
    <div class="d-flex justify-content-between align-items-center mb-4">
      <h3>Doanh Thu Theo Tháng</h3>
      <div>
        <label for="yearSelector" class="me-2">Chọn Năm:</label>
        <select id="yearSelector" class="form-select">
          <?php foreach (array_keys($groupedByYear) as $year): ?>
            <option value="<?= $year ?>" <?= $year == $currentYear ? 'selected' : '' ?>><?= $year ?></option>
          <?php endforeach; ?>
        </select>
      </div>
    </div>

    <!-- Biểu đồ -->
    <div class="chart-container">
      <canvas id="revenueChart"></canvas>
    </div>
  </div>
</main>

<script>
  // Dữ liệu PHP sang JavaScript
  const groupedByYear = <?= json_encode($groupedByYear); ?>;
  const currentYear = <?= $currentYear; ?>;
  const months = <?= $monthsJSON; ?>;
  const revenues = <?= $revenuesJSON; ?>;

  // Khởi tạo biểu đồ
  const ctx = document.getElementById('revenueChart').getContext('2d');
  let revenueChart = createChart(ctx, months, revenues);

  // Hàm tạo biểu đồ
  function createChart(ctx, labels, data) {
    return new Chart(ctx, {
      type: 'line',
      data: {
        labels: labels,
        datasets: [{
          label: 'Doanh Thu',
          data: data,
          borderColor: '#007bff',
          backgroundColor: 'rgba(0, 123, 255, 0.2)',
          borderWidth: 2,
        }]
      },
      options: {
        responsive: true,
        plugins: {
          legend: { display: true },
        }
      }
    });
  }

  // Xử lý khi chọn năm
  document.getElementById('yearSelector').addEventListener('change', function () {
    const selectedYear = this.value;
    const yearData = groupedByYear[selectedYear] || [];
    const labels = yearData.map(data => `Tháng ${data.thang}`);
    const data = yearData.map(data => data.tongtien);

    // Cập nhật biểu đồ
    revenueChart.destroy(); // Hủy biểu đồ cũ
    revenueChart = createChart(ctx, labels, data); // Tạo biểu đồ mới
  });
</script>